!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,(function(){return(()=>{function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}return tinySheet=function(e,n){var r=this;this.containerEl=e;var s=Array.from(e.getElementsByTagName("input"));this.elements=s;var i,a=0;if(n&&n.patches){var o=d();v(n.patches.flat(),o),i=n.patches,a=i.length}else i=[];this.patches=i;var l=document.createElement("TEXTAREA"),c=l.style;function u(t){l.style.left=t.getBoundingClientRect().x+window.scrollX+3+"px",l.style.top=t.getBoundingClientRect().y+window.scrollY+3+"px"}c.position="absolute",c.border="none",c.color="transparent",c.background="transparent",c["text-shadow"]="0 0 0 transparent",c.width="0.10em",c.height="0.10em",c["z-index"]=-9999,c.resize="none",c.outline="none",c["Äºeft"]="-99999999px",l.classList.add("tnys-clip"),document.body.appendChild(l);var g=!0;function f(){i.splice(a++)}function d(){var t=Array.from(s),e=t.filter((function(e){return e.getBoundingClientRect().y===t[0].getBoundingClientRect().y})).length;return A(t,e)}l.addEventListener("keyup",(function(t){g=!0,l.setSelectionRange(0,l.value.length),17===t.keyCode&&window.setTimeout((function(){var t=e.getElementsByClassName("tnys-focus")[0];t&&t.focus({preventScroll:!0})}),30)})),l.addEventListener("keydown",(function(t){if(t.ctrlKey&&"v"===t.key){if(!g)return void t.preventDefault();g=!1;var n=e.getElementsByClassName("tnys-focus")[0];n&&window.setTimeout((function(){var r,s=function(t){var e,n,r,s,i,a,o,l=[],c=0;for((r=t.split("\n")).length>1&&""===r[r.length-1]&&r.pop(),e=0,n=r.length;e<n;e+=1){for(r[e]=r[e].split("\t"),s=0,i=r[e].length;s<i;s+=1)l[c]||(l[c]=[]),a&&0===s?(o=l[c].length-1,l[c][o]=l[c][o]+"\n"+r[e][0],a&&1&w(r[e][0])&&(a=!1,l[c][o]=l[c][o].substring(0,l[c][o].length-1).replace(/""/g,'"'))):s===i-1&&0===r[e][s].indexOf('"')&&1&w(r[e][s])?(l[c].push(r[e][s].substring(1).replace(/""/g,'"')),a=!0):(l[c].push(r[e][s].replace(/""/g,'"')),a=!1);a||(c+=1)}return l}(t.target.value),a=s.length,o=s[0].length,l=Array.from(e.getElementsByClassName("tnys-sel"));if(l.length){var c=l.filter((function(t){return t.getBoundingClientRect().y===l[0].getBoundingClientRect().y})).length;r=A(l,c)}else r=[[n]];var u=Array.from(e.getElementsByTagName("input")).filter((function(t){return t.getBoundingClientRect().y>=r[0][0].getBoundingClientRect().y&&t.getBoundingClientRect().x>=r[0][0].getBoundingClientRect().x})),g=u.filter((function(t){return t.getBoundingClientRect().y===u[0].getBoundingClientRect().y})).length,d=A(u,g),y=d.length,v=r.length,m=r[0].length,p=Math.max(Math.floor(v/a)*a,a),h=Math.max(Math.floor(m/o)*o,o);if(p>y)console.error("cannot paste (pasteHeigth > pasteAreaHeigth)");else if(h>g)console.error("cannot paste (pasteWidth > pasteAreaWidth)");else{for(var C=[],B=R(r[0][0]),L=0;L<p;L++)for(var b=0;b<h;b++){d[L][b].value=s[L%a][b%o],d[L][b].classList.add("tnys-sel");var E="".concat(B.rowIndex+L,"_").concat(B.colIndex+b);C.push({op:"add",path:"/".concat(E),value:d[L][b].value})}f(),i.push(C)}}),20)}else if(t.ctrlKey&&"c"===t.key);else{l.blur();var r=e.getElementsByClassName("tnys-focus")[0];r.focus({preventScroll:!0}),Object.defineProperty(t,"target",{value:r}),B(t)}})),this.getElementsMatrix=d,this.getData=function(){return d().map((function(t){return t.map((function(t){return t.value}))}))};var y={pointers:{}};function v(t,e){t.forEach((function(t){var n=t.path.split("/")[1].split("_").map((function(t){return parseInt(t)})),r=e[n[0]];r?r[n[1]].value=t.value:console.warn("row ".concat(t.path," does not exists."))}))}function m(t,n){var r=Array.from(e.getElementsByClassName("tnys-sel"));r.length||(r=[n]);var s=r.filter((function(t){return t.getBoundingClientRect().y===r[0].getBoundingClientRect().y})).length,i=function(t){var e,n,r,s,i,a="";for(e=0,n=t.length;e<n;e+=1){for(r=0,s=t[e].length;r<s;r+=1)r>0&&(a+="\t"),"string"==typeof(i=t[e][r])?i.indexOf("\n")>-1?a+='"'+i.replace(/"/g,'""')+'"':a+=i:a+=null==i?"":i;a+="\n"}return a}(A(r.map((function(t){return t.value})),s));l.value=i,l.focus(),t.preventDefault()}function p(t,e,n){for(var r=t.map((function(t){return t.getAttribute("tnys-id")})),s=[y.pointers[e.getAttribute("tnys-id")][n]];;){var i=s[s.length-1];if(!i){s.pop(),s=s.filter((function(t){return r.includes(t.getAttribute("tnys-id"))}));break}s.push(y.pointers[i.getAttribute("tnys-id")][n])}return s}function h(){var t=Array.from(e.getElementsByClassName("tnys-focus"))[0];t&&(t.blur(),t.focus({preventScroll:!0}))}this.setMap=function(){var t=d();y.pointers={};for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++){var r="".concat(e,"_").concat(n);t[e][n].setAttribute("tnys-id",r),y.pointers[r]={t:t[e-1]?t[e-1][n]:void 0,b:t[e+1]?t[e+1][n]:void 0,l:t[e]?t[e][n-1]:void 0,r:t[e]?t[e][n+1]:void 0}}};var C=void 0;function B(n){if(C&&s.length>3e3&&n.timeStamp<C+50)n.preventDefault();else if(C=n.timeStamp,n.target.classList.contains("tnys-editing")||!n.ctrlKey||"y"!==n.key)if(n.target.classList.contains("tnys-editing")||!n.ctrlKey||"z"!==n.key){if(!n.target.classList.contains("tnys-editing")&&n.ctrlKey&&(m(n,n.target),l.focus(),l.setSelectionRange(0,l.value.length)),n.ctrlKey||n.target.classList.contains("tnys-editing")||[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,44,45,46,91,92,93,112,113,114,115,116,117,118,119,120,121,122,123,144,145,173,174,175,181,182,183,225].includes(n.keyCode)||(n.target.setAttribute("tnys-prev-value",n.target.value),n.target.value="",b(n.target)),!n.target.classList.contains("tnys-editing")&&(46===n.keyCode||8===n.keyCode)){var r=[];s.filter((function(t){return t.classList.contains("tnys-sel")||t.classList.contains("tnys-focus")})).forEach((function(t){if(""!==t.value){t.value="";var e=R(t),n="".concat(e.rowIndex,"_").concat(e.colIndex);r.push({op:"add",path:"/".concat(n),value:""})}})),r.length&&(f(),i.push(r))}if(13===n.keyCode&&n.target.classList.contains("tnys-editing")&&(n.target.classList.remove("tnys-editing"),n.target.classList.remove("tnys-editing-hard")),113===n.keyCode&&(n.target.setAttribute("tnys-prev-value",n.target.value),n.target.focus(),n.target.classList.contains("tnys-editing")||L(n.target),n.target.classList.add("tnys-editing-hard"),b(n.target)),27===n.keyCode&&n.target.classList.contains("tnys-editing")&&(n.target.value=n.target.getAttribute("tnys-prev-value"),n.target.classList.remove("tnys-editing"),n.target.classList.remove("tnys-editing-hard"),L(n.target)),[37,38,39,40,9].includes(n.keyCode)||!n.target.classList.contains("tnys-editing")){var o=function(e,n,r){var s=r?function(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n).reverse():n;if(s.map((function(t){return Boolean(t.value)})).reduce((function(t,e){return t||e}),!1)){for(var i=[e].concat(s),a=1;a<i.length;a++)if(Boolean(i[a].value)&&(Boolean(i[a].value)!==(i[a-1]&&Boolean(i[a-1].value))||Boolean(i[a].value)!==(i[a+1]&&Boolean(i[a+1].value)))){c=i[a];break}}else c=s[s.length-1];h()};if(9!==n.keyCode&&n.target.classList.contains("tnys-editing-hard"))return;n.target.classList.contains("tnys-editing")&&(n.target.classList.remove("tnys-editing"),n.target.classList.remove("tnys-editing-hard"));var c,g=n.target,y=(Array.from(e.getElementsByClassName("tnys-focus"))[0],Array.from(e.getElementsByClassName("tnys-sel-to"))[0]),B=Array.from(e.getElementsByClassName("tnys-sel-from"))[0],k=Array.from(e.getElementsByClassName("tnys-sel")),x=!1;[37,38,39,40].includes(n.keyCode)&&(n.shiftKey?(x=!0,g=y||n.target,B||(B=g).classList.add("tnys-sel-from")):(s.forEach((function(t){t.classList.remove("tnys-sel-from")})),k.forEach((function(t){t.classList.remove("tnys-sel"),t.classList.remove("tnys-sel-to"),t.classList.remove("tnys-sel-from")}))));var A=k.length>1;if("ArrowDown"===n.key||"Enter"===n.key&&!n.shiftKey){var w=A&&"Enter"===n.key?k:s,S=p(w,g,"b");if("ArrowDown"===n.key&&n.ctrlKey?o(g,S,!1):c=S[0],!c&&"Enter"===n.key){var K=w.filter((function(t){return t.getBoundingClientRect().x>g.getBoundingClientRect().x}));c=K[0]?K[0]:w[0]}}if("ArrowUp"===n.key||"Enter"===n.key&&n.shiftKey){var I=A&&"Enter"===n.key?k:s,N=p(I,g,"t");if("ArrowUp"===n.key&&n.ctrlKey?o(g,N,!1):c=N[0],!c&&"Enter"===n.key){var T=I.filter((function(t){return t.getBoundingClientRect().x<g.getBoundingClientRect().x}));c=T[0]?T[T.length-1]:I[I.length-1]}}if("ArrowLeft"===n.key||n.shiftKey&&"Tab"===n.key){var D=A&&"Tab"===n.key?k:s,M=p(D,g,"l");if("ArrowLeft"===n.key&&n.ctrlKey?o(g,M,!1):c=M[0],!c&&"Tab"===n.key){var O=D.filter((function(t){return t.getBoundingClientRect().y<g.getBoundingClientRect().y}));c=O[0]?O[O.length-1]:D[D.length-1]}}if("ArrowRight"===n.key||!n.shiftKey&&"Tab"===n.key){var j=A&&"Tab"===n.key?k:s,_=p(j,g,"r");if("ArrowRight"===n.key&&n.ctrlKey?o(g,_,!1):c=_[0],!c&&"Tab"===n.key){var z=j.filter((function(t){return t.getBoundingClientRect().y>g.getBoundingClientRect().y}));c=z[0]?z[0]:j[0]}}c&&(n.preventDefault(),u(c),window.setTimeout((function(){m(n,c)}),20),x?(g.classList.remove("tnys-sel-to"),c.classList.add("tnys-sel-to"),B&&E(B,c)):c.focus()),k.length<=1&&[9,13].includes(n.keyCode)&&(s.forEach((function(t){t.classList.remove("tnys-sel"),t.classList.remove("tnys-sel-from"),t.classList.remove("tnys-sel-to")})),c.classList.add("tnys-sel-from"))}}else{if(a>0){var U=d();i[a-1].forEach((function(t){for(var e=!1,n=a-2;n>=0;n--)if(i[n].map((function(t){return t.path})).includes(t.path)){e=!0,v(i[n].filter((function(e){return e.path===t.path})),U);break}if(!e){var r=t.path.split("/")[1].split("_").map((function(t){return parseInt(t)}));U[r[0]][r[1]].value=""}})),a--}n.preventDefault()}else{n.preventDefault();var F=i[a];F&&(v(F,d()),a++)}}function L(t){if("number"==typeof t.selectionStart)t.selectionStart=t.selectionEnd=t.value.length;else if(void 0!==t.createTextRange){t.focus();var e=t.createTextRange();e.collapse(!1),e.select()}}function b(t){t.classList.add("tnys-editing")}function E(t,e){var n=Math.min(t.getBoundingClientRect().x,e.getBoundingClientRect().x),r=Math.max(t.getBoundingClientRect().x,e.getBoundingClientRect().x),i=Math.min(t.getBoundingClientRect().y,e.getBoundingClientRect().y),a=Math.max(t.getBoundingClientRect().y,e.getBoundingClientRect().y);s.forEach((function(t){t.getBoundingClientRect().x>=n&&t.getBoundingClientRect().x<=r&&t.getBoundingClientRect().y>=i&&t.getBoundingClientRect().y<=a?t.classList.add("tnys-sel"):t.classList.remove("tnys-sel")}))}function R(t){var e=s.filter((function(e){return e.getBoundingClientRect().y===t.getBoundingClientRect().y})).map((function(t){return t.getBoundingClientRect().x}));return{rowIndex:s.filter((function(e){return e.getBoundingClientRect().x===t.getBoundingClientRect().x})).map((function(t){return t.getBoundingClientRect().y})).indexOf(t.getBoundingClientRect().y),colIndex:e.indexOf(t.getBoundingClientRect().x)}}function k(t){var e=Object({targetId:t.target.id,ctrlKey:t.ctrlKey,key:t.key,type:t.type,keyCode:t.keyCode,shiftKey:t.shiftKey,which:t.which,timeStamp:t.timeStamp});return JSON.parse(JSON.stringify(e))}function x(t){return t.constructor===Event||t.constructor===KeyboardEvent||t.constructor===MouseEvent||t.constructor===FocusEvent?t:Object.assign({},t,{preventDefault:function(){},target:document.getElementById(t.targetId)})}function A(t,e){return t.reduce((function(t,n,r){return r%e||t.push([]),t[t.length-1].push(n),t}),[])}function w(t){return t.split('"').length-1}this.update=function(){!function(t,e){for(var n=t.length-1;n>=0;n-=1)t[n].isConnected||t.splice(n,1)}(r.elements),Array.from(e.querySelectorAll("input:not(.tnys)")).forEach((function(t){t.classList.add("tnys"),function(t){t.addEventListener("change",(function(t){n&&n.recordCb&&n.recordCb({evt:k(t)});var e=R((t=x(t)).target),r="".concat(e.rowIndex,"_").concat(e.colIndex);f(),i.push([{op:"add",path:"/".concat(r),value:t.target.value}])})),t.addEventListener("keydown",B),t.addEventListener("focus",(function(t){n&&n.recordCb&&n.recordCb({evt:k(t)}),(t=x(t)).target.selectionStart=t.target.selectionEnd=t.target.value.length,s.forEach((function(t){t.classList.remove("tnys-focus")})),t.target.classList.add("tnys-focus")})),t.addEventListener("blur",(function(e){n&&n.recordCb&&n.recordCb({evt:k(e)}),e=x(e),t.classList.remove("tnys-editing"),t.classList.remove("tnys-editing-hard")}));var r=!1;e.addEventListener("mouseup",(function(t){r=!1})),e.addEventListener("mousedown",(function(t){r=!0})),t.addEventListener("mouseenter",(function(t){if(n&&n.recordCb&&n.recordCb({evt:k(t)}),t=x(t),r){s.forEach((function(t){t.classList.remove("tnys-sel-to"),t.classList.remove("tnys-sel")}));var i=Array.from(e.getElementsByClassName("tnys-sel-from"))[0];t.target.classList.add("tnys-sel-to"),i&&E(i,t.target)}})),t.addEventListener("mousedown",(function(r){n&&n.recordCb&&n.recordCb({evt:k(r)}),u((r=x(r)).target),s.forEach((function(t){t.classList.remove("tnys-sel-to"),t.classList.remove("tnys-sel")}));var i=Array.from(e.getElementsByClassName("tnys-sel-from"));if(r.shiftKey){if(i.length){r.preventDefault();var a=i[0];r.target.classList.add("tnys-sel-to"),h(),E(a,r.target)}}else{i.forEach((function(t){t.classList.remove("tnys-sel-from")}));var o=r.target.getAttribute("tnys-last-mousedown");o&&r.timeStamp-parseFloat(o)<=500&&!r.target.classList.contains("tnys-editing")&&(t.setAttribute("tnys-prev-value",t.value),r.preventDefault(),r.target.classList.add("tnys-editing-hard"),b(r.target)),r.target.setAttribute("tnys-last-mousedown",r.timeStamp),r.target.classList.add("tnys-sel-from"),r.target.focus(),void 0===r.mozInputSource||r.target.classList.contains("tnys-editing")||r.preventDefault()}}))}(t),r.elements.includes(t)||r.elements.push(t)})),r.elements.sort((function(t,e){return t.getBoundingClientRect().y-e.getBoundingClientRect().y})),r.setMap()},this.update()},{}})()}));