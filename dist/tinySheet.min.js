!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,(function(){return(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}t.r(e),t.d(e,{default:()=>s});var r=function(t,e){var r=this;this.containerEl=t;var s=Array.from(t.getElementsByTagName("input"));this.elements=s;var i,a=0;if(e&&e.patches){var o=d();v(e.patches.flat(),o),i=e.patches,a=i.length}else i=[];this.patches=i;var l=document.createElement("TEXTAREA"),c=l.style;function u(t){l.style.left=t.getBoundingClientRect().x+window.scrollX+3+"px",l.style.top=t.getBoundingClientRect().y+window.scrollY+3+"px"}c.position="absolute",c.border="none",c.color="transparent",c.background="transparent",c["text-shadow"]="0 0 0 transparent",c.width="0.10em",c.height="0.10em",c["z-index"]=-9999,c.resize="none",c.outline="none",c["Äºeft"]="-99999999px",l.classList.add("tnys-clip"),document.body.appendChild(l);var g=!0;function f(){i.splice(a++)}function d(){var t=Array.from(s),e=t.filter((function(e){return e.getBoundingClientRect().y===t[0].getBoundingClientRect().y})).length;return w(t,e)}l.addEventListener("keyup",(function(e){g=!0,l.setSelectionRange(0,l.value.length),17===e.keyCode&&window.setTimeout((function(){var e=t.getElementsByClassName("tnys-focus")[0];e&&e.focus({preventScroll:!0})}),30)})),l.addEventListener("keydown",(function(e){if(e.ctrlKey&&"v"===e.key){if(!g)return void e.preventDefault();g=!1;var n=t.getElementsByClassName("tnys-focus")[0];n&&window.setTimeout((function(){var r,s=function(t){var e,n,r,s,i,a,o,l=[],c=0;for((r=t.split("\n")).length>1&&""===r[r.length-1]&&r.pop(),e=0,n=r.length;e<n;e+=1){for(r[e]=r[e].split("\t"),s=0,i=r[e].length;s<i;s+=1)l[c]||(l[c]=[]),a&&0===s?(o=l[c].length-1,l[c][o]=l[c][o]+"\n"+r[e][0],a&&1&A(r[e][0])&&(a=!1,l[c][o]=l[c][o].substring(0,l[c][o].length-1).replace(/""/g,'"'))):s===i-1&&0===r[e][s].indexOf('"')&&1&A(r[e][s])?(l[c].push(r[e][s].substring(1).replace(/""/g,'"')),a=!0):(l[c].push(r[e][s].replace(/""/g,'"')),a=!1);a||(c+=1)}return l}(e.target.value),a=s.length,o=s[0].length,l=Array.from(t.getElementsByClassName("tnys-sel"));if(l.length){var c=l.filter((function(t){return t.getBoundingClientRect().y===l[0].getBoundingClientRect().y})).length;r=w(l,c)}else r=[[n]];var u=Array.from(t.getElementsByTagName("input")).filter((function(t){return t.getBoundingClientRect().y>=r[0][0].getBoundingClientRect().y&&t.getBoundingClientRect().x>=r[0][0].getBoundingClientRect().x})),g=u.filter((function(t){return t.getBoundingClientRect().y===u[0].getBoundingClientRect().y})).length,d=w(u,g),y=d.length,v=r.length,p=r[0].length,m=Math.max(Math.floor(v/a)*a,a),h=Math.max(Math.floor(p/o)*o,o);if(m>y)console.error("cannot paste (pasteHeigth > pasteAreaHeigth)");else if(h>g)console.error("cannot paste (pasteWidth > pasteAreaWidth)");else{for(var C=[],b=R(r[0][0]),B=0;B<m;B++)for(var L=0;L<h;L++){d[B][L].value=s[B%a][L%o],d[B][L].classList.add("tnys-sel");var E="".concat(b.rowIndex+B,"_").concat(b.colIndex+L);C.push({op:"add",path:"/".concat(E),value:d[B][L].value})}f(),i.push(C)}}),20)}else if(e.ctrlKey&&"c"===e.key);else{l.blur();var r=t.getElementsByClassName("tnys-focus")[0];r.focus({preventScroll:!0}),Object.defineProperty(e,"target",{value:r}),b(e)}})),this.getElementsMatrix=d,this.getData=function(){return d().map((function(t){return t.map((function(t){return t.value}))}))};var y={pointers:{}};function v(t,e){t.forEach((function(t){var n=t.path.split("/")[1].split("_").map((function(t){return parseInt(t)})),r=e[n[0]];r?r[n[1]].value=t.value:console.warn("row ".concat(t.path," does not exists."))}))}function p(e,n){var r=Array.from(t.getElementsByClassName("tnys-sel"));r.length||(r=[n]);var s=r.filter((function(t){return t.getBoundingClientRect().y===r[0].getBoundingClientRect().y})).length,i=function(t){var e,n,r,s,i,a="";for(e=0,n=t.length;e<n;e+=1){for(r=0,s=t[e].length;r<s;r+=1)r>0&&(a+="\t"),"string"==typeof(i=t[e][r])?i.indexOf("\n")>-1?a+='"'+i.replace(/"/g,'""')+'"':a+=i:a+=null==i?"":i;a+="\n"}return a}(w(r.map((function(t){return t.value})),s));l.value=i,l.focus(),e.preventDefault()}function m(t,e,n){for(var r=t.map((function(t){return t.getAttribute("tnys-id")})),s=[y.pointers[e.getAttribute("tnys-id")][n]];;){var i=s[s.length-1];if(!i){s.pop(),s=s.filter((function(t){return r.includes(t.getAttribute("tnys-id"))}));break}s.push(y.pointers[i.getAttribute("tnys-id")][n])}return s}function h(){var e=Array.from(t.getElementsByClassName("tnys-focus"))[0];e&&(e.blur(),e.focus({preventScroll:!0}))}this.setMap=function(){var t=d();y.pointers={};for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++){var r="".concat(e,"_").concat(n);t[e][n].setAttribute("tnys-id",r),y.pointers[r]={t:t[e-1]?t[e-1][n]:void 0,b:t[e+1]?t[e+1][n]:void 0,l:t[e]?t[e][n-1]:void 0,r:t[e]?t[e][n+1]:void 0}}};var C=void 0;function b(e){if(C&&s.length>3e3&&e.timeStamp<C+50)e.preventDefault();else if(C=e.timeStamp,e.target.classList.contains("tnys-editing")||!e.ctrlKey||"y"!==e.key)if(e.target.classList.contains("tnys-editing")||!e.ctrlKey||"z"!==e.key){if(!e.target.classList.contains("tnys-editing")&&e.ctrlKey&&(p(e,e.target),l.focus(),l.setSelectionRange(0,l.value.length)),e.ctrlKey||e.target.classList.contains("tnys-editing")||[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,44,45,46,91,92,93,112,113,114,115,116,117,118,119,120,121,122,123,144,145,173,174,175,181,182,183,225].includes(e.keyCode)||(e.target.setAttribute("tnys-prev-value",e.target.value),e.target.value="",L(e.target)),!e.target.classList.contains("tnys-editing")&&(46===e.keyCode||8===e.keyCode)){var r=[];s.filter((function(t){return t.classList.contains("tnys-sel")||t.classList.contains("tnys-focus")})).forEach((function(t){if(""!==t.value){t.value="";var e=R(t),n="".concat(e.rowIndex,"_").concat(e.colIndex);r.push({op:"add",path:"/".concat(n),value:""})}})),r.length&&(f(),i.push(r))}if(13===e.keyCode&&e.target.classList.contains("tnys-editing")&&(e.target.classList.remove("tnys-editing"),e.target.classList.remove("tnys-editing-hard")),113===e.keyCode&&(e.target.setAttribute("tnys-prev-value",e.target.value),e.target.focus(),e.target.classList.contains("tnys-editing")||B(e.target),e.target.classList.add("tnys-editing-hard"),L(e.target)),27===e.keyCode&&e.target.classList.contains("tnys-editing")&&(e.target.value=e.target.getAttribute("tnys-prev-value"),e.target.classList.remove("tnys-editing"),e.target.classList.remove("tnys-editing-hard"),B(e.target)),[37,38,39,40,9].includes(e.keyCode)||!e.target.classList.contains("tnys-editing")){var o=function(t,e,r){var s=r?function(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e).reverse():e;if(s.map((function(t){return Boolean(t.value)})).reduce((function(t,e){return t||e}),!1)){for(var i=[t].concat(s),a=1;a<i.length;a++)if(Boolean(i[a].value)&&(Boolean(i[a].value)!==(i[a-1]&&Boolean(i[a-1].value))||Boolean(i[a].value)!==(i[a+1]&&Boolean(i[a+1].value)))){c=i[a];break}}else c=s[s.length-1];h()};if(9!==e.keyCode&&e.target.classList.contains("tnys-editing-hard"))return;e.target.classList.contains("tnys-editing")&&(e.target.classList.remove("tnys-editing"),e.target.classList.remove("tnys-editing-hard"));var c,g=e.target,y=(Array.from(t.getElementsByClassName("tnys-focus"))[0],Array.from(t.getElementsByClassName("tnys-sel-to"))[0]),b=Array.from(t.getElementsByClassName("tnys-sel-from"))[0],k=Array.from(t.getElementsByClassName("tnys-sel")),x=!1;[37,38,39,40].includes(e.keyCode)&&(e.shiftKey?(x=!0,g=y||e.target,b||(b=g).classList.add("tnys-sel-from")):(s.forEach((function(t){t.classList.remove("tnys-sel-from")})),k.forEach((function(t){t.classList.remove("tnys-sel"),t.classList.remove("tnys-sel-to"),t.classList.remove("tnys-sel-from")}))));var w=k.length>1;if("ArrowDown"===e.key||"Enter"===e.key&&!e.shiftKey){var A=w&&"Enter"===e.key?k:s,S=m(A,g,"b");if("ArrowDown"===e.key&&e.ctrlKey?o(g,S,!1):c=S[0],!c&&"Enter"===e.key){var K=A.filter((function(t){return t.getBoundingClientRect().x>g.getBoundingClientRect().x}));c=K[0]?K[0]:A[0]}}if("ArrowUp"===e.key||"Enter"===e.key&&e.shiftKey){var T=w&&"Enter"===e.key?k:s,I=m(T,g,"t");if("ArrowUp"===e.key&&e.ctrlKey?o(g,I,!1):c=I[0],!c&&"Enter"===e.key){var N=T.filter((function(t){return t.getBoundingClientRect().x<g.getBoundingClientRect().x}));c=N[0]?N[N.length-1]:T[T.length-1]}}if("ArrowLeft"===e.key||e.shiftKey&&"Tab"===e.key){var O=w&&"Tab"===e.key?k:s,M=m(O,g,"l");if("ArrowLeft"===e.key&&e.ctrlKey?o(g,M,!1):c=M[0],!c&&"Tab"===e.key){var j=O.filter((function(t){return t.getBoundingClientRect().y<g.getBoundingClientRect().y}));c=j[0]?j[j.length-1]:O[O.length-1]}}if("ArrowRight"===e.key||!e.shiftKey&&"Tab"===e.key){var D=w&&"Tab"===e.key?k:s,_=m(D,g,"r");if("ArrowRight"===e.key&&e.ctrlKey?o(g,_,!1):c=_[0],!c&&"Tab"===e.key){var P=D.filter((function(t){return t.getBoundingClientRect().y>g.getBoundingClientRect().y}));c=P[0]?P[0]:D[0]}}c&&(e.preventDefault(),u(c),window.setTimeout((function(){p(e,c)}),20),x?(g.classList.remove("tnys-sel-to"),c.classList.add("tnys-sel-to"),b&&E(b,c)):c.focus()),k.length<=1&&[9,13].includes(e.keyCode)&&(s.forEach((function(t){t.classList.remove("tnys-sel"),t.classList.remove("tnys-sel-from"),t.classList.remove("tnys-sel-to")})),c.classList.add("tnys-sel-from"))}}else{if(a>0){var z=d();i[a-1].forEach((function(t){for(var e=!1,n=a-2;n>=0;n--)if(i[n].map((function(t){return t.path})).includes(t.path)){e=!0,v(i[n].filter((function(e){return e.path===t.path})),z);break}if(!e){var r=t.path.split("/")[1].split("_").map((function(t){return parseInt(t)}));z[r[0]][r[1]].value=""}})),a--}e.preventDefault()}else{e.preventDefault();var U=i[a];U&&(v(U,d()),a++)}}function B(t){if("number"==typeof t.selectionStart)t.selectionStart=t.selectionEnd=t.value.length;else if(void 0!==t.createTextRange){t.focus();var e=t.createTextRange();e.collapse(!1),e.select()}}function L(t){t.classList.add("tnys-editing")}function E(t,e){var n=Math.min(t.getBoundingClientRect().x,e.getBoundingClientRect().x),r=Math.max(t.getBoundingClientRect().x,e.getBoundingClientRect().x),i=Math.min(t.getBoundingClientRect().y,e.getBoundingClientRect().y),a=Math.max(t.getBoundingClientRect().y,e.getBoundingClientRect().y);s.forEach((function(t){t.getBoundingClientRect().x>=n&&t.getBoundingClientRect().x<=r&&t.getBoundingClientRect().y>=i&&t.getBoundingClientRect().y<=a?t.classList.add("tnys-sel"):t.classList.remove("tnys-sel")}))}function R(t){var e=s.filter((function(e){return e.getBoundingClientRect().y===t.getBoundingClientRect().y})).map((function(t){return t.getBoundingClientRect().x}));return{rowIndex:s.filter((function(e){return e.getBoundingClientRect().x===t.getBoundingClientRect().x})).map((function(t){return t.getBoundingClientRect().y})).indexOf(t.getBoundingClientRect().y),colIndex:e.indexOf(t.getBoundingClientRect().x)}}function k(t){var e=Object({targetId:t.target.id,ctrlKey:t.ctrlKey,key:t.key,type:t.type,keyCode:t.keyCode,shiftKey:t.shiftKey,which:t.which,timeStamp:t.timeStamp});return JSON.parse(JSON.stringify(e))}function x(t){return t.constructor===Event||t.constructor===KeyboardEvent||t.constructor===MouseEvent||t.constructor===FocusEvent?t:Object.assign({},t,{preventDefault:function(){},target:document.getElementById(t.targetId)})}function w(t,e){return t.reduce((function(t,n,r){return r%e||t.push([]),t[t.length-1].push(n),t}),[])}function A(t){return t.split('"').length-1}this.update=function(){!function(t,e){for(var n=t.length-1;n>=0;n-=1)t[n].isConnected||t.splice(n,1)}(r.elements),Array.from(t.querySelectorAll("input:not(.tnys)")).forEach((function(n){n.classList.add("tnys"),function(n){n.addEventListener("change",(function(t){e&&e.recordCb&&e.recordCb({evt:k(t)});var n=R((t=x(t)).target),r="".concat(n.rowIndex,"_").concat(n.colIndex);f(),i.push([{op:"add",path:"/".concat(r),value:t.target.value}])})),n.addEventListener("keydown",b),n.addEventListener("focus",(function(t){e&&e.recordCb&&e.recordCb({evt:k(t)}),(t=x(t)).target.selectionStart=t.target.selectionEnd=t.target.value.length,s.forEach((function(t){t.classList.remove("tnys-focus")})),t.target.classList.add("tnys-focus")})),n.addEventListener("blur",(function(t){e&&e.recordCb&&e.recordCb({evt:k(t)}),t=x(t),n.classList.remove("tnys-editing"),n.classList.remove("tnys-editing-hard")}));var r=!1;t.addEventListener("mouseup",(function(t){r=!1})),t.addEventListener("mousedown",(function(t){r=!0})),n.addEventListener("mouseenter",(function(n){if(e&&e.recordCb&&e.recordCb({evt:k(n)}),n=x(n),r){s.forEach((function(t){t.classList.remove("tnys-sel-to"),t.classList.remove("tnys-sel")}));var i=Array.from(t.getElementsByClassName("tnys-sel-from"))[0];n.target.classList.add("tnys-sel-to"),i&&E(i,n.target)}})),n.addEventListener("mousedown",(function(r){e&&e.recordCb&&e.recordCb({evt:k(r)}),u((r=x(r)).target),s.forEach((function(t){t.classList.remove("tnys-sel-to"),t.classList.remove("tnys-sel")}));var i=Array.from(t.getElementsByClassName("tnys-sel-from"));if(r.shiftKey){if(i.length){r.preventDefault();var a=i[0];r.target.classList.add("tnys-sel-to"),h(),E(a,r.target)}}else{i.forEach((function(t){t.classList.remove("tnys-sel-from")}));var o=r.target.getAttribute("tnys-last-mousedown");o&&r.timeStamp-parseFloat(o)<=500&&!r.target.classList.contains("tnys-editing")&&(n.setAttribute("tnys-prev-value",n.value),r.preventDefault(),r.target.classList.add("tnys-editing-hard"),L(r.target)),r.target.setAttribute("tnys-last-mousedown",r.timeStamp),r.target.classList.add("tnys-sel-from"),r.target.focus(),void 0===r.mozInputSource||r.target.classList.contains("tnys-editing")||r.preventDefault()}}))}(n),r.elements.includes(n)||r.elements.push(n)})),r.elements.sort((function(t,e){return t.getBoundingClientRect().y-e.getBoundingClientRect().y})),r.setMap()},this.update()};window&&(window.tinySheet=r);const s={tinySheet:r};return e})()}));