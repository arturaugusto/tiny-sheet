({138:function(){tinySheet=(e,t)=>{this.containerEl=e;let n=Array.from(e.getElementsByTagName("input"));this.elements=n;let s,l=0;if(t&&t.patches){let e=g();y(t.patches.flat(),e),s=t.patches,l=s.length}else s=[];this.patches=s;let i=document.createElement("TEXTAREA"),r=i.style;function a(e){i.style.left=e.getBoundingClientRect().x+window.scrollX+3+"px",i.style.top=e.getBoundingClientRect().y+window.scrollY+3+"px"}r.position="absolute",r.border="none",r.color="transparent",r.background="transparent",r["text-shadow"]="0 0 0 transparent",r.width="0.10em",r.height="0.10em",r["z-index"]=-9999,r.resize="none",r.outline="none",r["Äºeft"]="-99999999px",i.classList.add("tnys-clip"),document.body.appendChild(i);let o=!0;function c(){s.splice(l++)}function g(){let e=Array.from(n),t=e.filter((t=>t.getBoundingClientRect().y===e[0].getBoundingClientRect().y)).length;return b(e,t)}i.addEventListener("keyup",(t=>{o=!0,i.setSelectionRange(0,i.value.length),17===t.keyCode&&window.setTimeout((()=>{let t=e.getElementsByClassName("tnys-focus")[0];t&&t.focus({preventScroll:!0})}),30)})),i.addEventListener("keydown",(t=>{if(t.ctrlKey&&"v"===t.key){if(!o)return void t.preventDefault();o=!1;let n=e.getElementsByClassName("tnys-focus")[0];n&&window.setTimeout((()=>{let l,i=function(e){var t,n,s,l,i,r,a,o=[],c=0;for((s=e.split("\n")).length>1&&""===s[s.length-1]&&s.pop(),t=0,n=s.length;t<n;t+=1){for(s[t]=s[t].split("\t"),l=0,i=s[t].length;l<i;l+=1)o[c]||(o[c]=[]),r&&0===l?(a=o[c].length-1,o[c][a]=o[c][a]+"\n"+s[t][0],r&&1&k(s[t][0])&&(r=!1,o[c][a]=o[c][a].substring(0,o[c][a].length-1).replace(/""/g,'"'))):l===i-1&&0===s[t][l].indexOf('"')&&1&k(s[t][l])?(o[c].push(s[t][l].substring(1).replace(/""/g,'"')),r=!0):(o[c].push(s[t][l].replace(/""/g,'"')),r=!1);r||(c+=1)}return o}(t.target.value),r=i.length,a=i[0].length,o=Array.from(e.getElementsByClassName("tnys-sel"));if(o.length){let e=o.filter((e=>e.getBoundingClientRect().y===o[0].getBoundingClientRect().y)).length;l=b(o,e)}else l=[[n]];let g=Array.from(e.getElementsByTagName("input")).filter((e=>e.getBoundingClientRect().y>=l[0][0].getBoundingClientRect().y&&e.getBoundingClientRect().x>=l[0][0].getBoundingClientRect().x)),d=g.filter((e=>e.getBoundingClientRect().y===g[0].getBoundingClientRect().y)).length,u=b(g,d),y=u.length,f=l.length,h=l[0].length,m=Math.max(Math.floor(f/r)*r,r),p=Math.max(Math.floor(h/a)*a,a);if(m>y)return void console.error("cannot paste (pasteHeigth > pasteAreaHeigth)");if(p>d)return void console.error("cannot paste (pasteWidth > pasteAreaWidth)");let v=[],C=L(l[0][0]);for(var B=0;B<m;B++)for(var E=0;E<p;E++){u[B][E].value=i[B%r][E%a],u[B][E].classList.add("tnys-sel");let e=`${C.rowIndex+B}_${C.colIndex+E}`;v.push({op:"add",path:`/${e}`,value:u[B][E].value})}c(),s.push(v)}),20)}else if(t.ctrlKey&&"c"===t.key);else{i.blur();let n=e.getElementsByClassName("tnys-focus")[0];n.focus({preventScroll:!0}),Object.defineProperty(t,"target",{value:n}),p(t)}})),this.getElementsMatrix=g,this.getData=function(){return g().map((e=>e.map((e=>e.value))))};let d,u={pointers:{}};function y(e,t){e.forEach((e=>{let n=e.path.split("/")[1].split("_").map((e=>parseInt(e))),s=t[n[0]];s?s[n[1]].value=e.value:console.warn(`row ${e.path} does not exists.`)}))}function f(t,n){let s=Array.from(e.getElementsByClassName("tnys-sel"));s.length||(s=[n]);let l=s.filter((e=>e.getBoundingClientRect().y===s[0].getBoundingClientRect().y)).length,r=function(e){var t,n,s,l,i,r="";for(t=0,n=e.length;t<n;t+=1){for(s=0,l=e[t].length;s<l;s+=1)s>0&&(r+="\t"),"string"==typeof(i=e[t][s])?i.indexOf("\n")>-1?r+='"'+i.replace(/"/g,'""')+'"':r+=i:r+=null==i?"":i;r+="\n"}return r}(b(s.map((e=>e.value)),l));i.value=r,i.focus(),t.preventDefault()}function h(e,t,n){let s=e.map((e=>e.getAttribute("tnys-id"))),l=[u.pointers[t.getAttribute("tnys-id")][n]];for(;;){let e=l[l.length-1];if(!e){l.pop(),l=l.filter((e=>s.includes(e.getAttribute("tnys-id"))));break}l.push(u.pointers[e.getAttribute("tnys-id")][n])}return l}function m(){let t=Array.from(e.getElementsByClassName("tnys-focus"))[0];t&&(t.blur(),t.focus({preventScroll:!0}))}function p(t){if(d&&n.length>3e3&&t.timeStamp<d+50)t.preventDefault();else if(d=t.timeStamp,t.target.classList.contains("tnys-editing")||!t.ctrlKey||"y"!==t.key)if(t.target.classList.contains("tnys-editing")||!t.ctrlKey||"z"!==t.key){if(!t.target.classList.contains("tnys-editing")&&t.ctrlKey&&(f(t,t.target),i.focus(),i.setSelectionRange(0,i.value.length)),t.ctrlKey||t.target.classList.contains("tnys-editing")||[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,44,45,46,91,92,93,112,113,114,115,116,117,118,119,120,121,122,123,144,145,173,174,175,181,182,183,225].includes(t.keyCode)||(t.target.setAttribute("tnys-prev-value",t.target.value),t.target.value="",C(t.target)),!t.target.classList.contains("tnys-editing")&&(46===t.keyCode||8===t.keyCode)){let e=[];n.filter((e=>e.classList.contains("tnys-sel")||e.classList.contains("tnys-focus"))).forEach((t=>{t.value="";let n=L(t),s=`${n.rowIndex}_${n.colIndex}`;e.push({op:"add",path:`/${s}`,value:""})})),c(),s.push(e)}if(13===t.keyCode&&t.target.classList.contains("tnys-editing")&&(t.target.classList.remove("tnys-editing"),t.target.classList.remove("tnys-editing-hard")),113===t.keyCode&&(t.target.setAttribute("tnys-prev-value",t.target.value),t.target.focus(),t.target.classList.contains("tnys-editing")||v(t.target),t.target.classList.add("tnys-editing-hard"),C(t.target)),27===t.keyCode&&t.target.classList.contains("tnys-editing")&&(t.target.value=t.target.getAttribute("tnys-prev-value"),t.target.classList.remove("tnys-editing"),t.target.classList.remove("tnys-editing-hard"),v(t.target)),[37,38,39,40,9].includes(t.keyCode)||!t.target.classList.contains("tnys-editing")){if(9!==t.keyCode&&t.target.classList.contains("tnys-editing-hard"))return;t.target.classList.contains("tnys-editing")&&(t.target.classList.remove("tnys-editing"),t.target.classList.remove("tnys-editing-hard"));let s=t.target;Array.from(e.getElementsByClassName("tnys-focus"))[0];const l=Array.from(e.getElementsByClassName("tnys-sel-to"))[0];let i,o=Array.from(e.getElementsByClassName("tnys-sel-from"))[0],c=Array.from(e.getElementsByClassName("tnys-sel")),g=!1;function r(e,t,n){let s=n?[...t].reverse():t;if(s.map((e=>Boolean(e.value))).reduce(((e,t)=>e||t),!1)){let t=[e].concat(s);for(let e=1;e<t.length;e++)if(Boolean(t[e].value)&&(Boolean(t[e].value)!==(t[e-1]&&Boolean(t[e-1].value))||Boolean(t[e].value)!==(t[e+1]&&Boolean(t[e+1].value)))){i=t[e];break}}else i=s[s.length-1];m()}[37,38,39,40].includes(t.keyCode)&&(t.shiftKey?(g=!0,s=l||t.target,o||(o=s,o.classList.add("tnys-sel-from"))):(n.forEach((e=>{e.classList.remove("tnys-sel-from")})),c.forEach((e=>{e.classList.remove("tnys-sel"),e.classList.remove("tnys-sel-to"),e.classList.remove("tnys-sel-from")}))));const d=c.length>1;if("ArrowDown"===t.key||"Enter"===t.key&&!t.shiftKey){let e=d&&"Enter"===t.key?c:n,l=h(e,s,"b");if("ArrowDown"===t.key&&t.ctrlKey?r(s,l,!1):i=l[0],!i&&"Enter"===t.key){let t=e.filter((e=>e.getBoundingClientRect().x>s.getBoundingClientRect().x));i=t[0]?t[0]:e[0]}}if("ArrowUp"===t.key||"Enter"===t.key&&t.shiftKey){let e=d&&"Enter"===t.key?c:n,l=h(e,s,"t");if("ArrowUp"===t.key&&t.ctrlKey?r(s,l,!1):i=l[0],!i&&"Enter"===t.key){let t=e.filter((e=>e.getBoundingClientRect().x<s.getBoundingClientRect().x));i=t[0]?t[t.length-1]:e[e.length-1]}}if("ArrowLeft"===t.key||t.shiftKey&&"Tab"===t.key){let e=d&&"Tab"===t.key?c:n,l=h(e,s,"l");if("ArrowLeft"===t.key&&t.ctrlKey?r(s,l,!1):i=l[0],!i&&"Tab"===t.key){let t=e.filter((e=>e.getBoundingClientRect().y<s.getBoundingClientRect().y));i=t[0]?t[t.length-1]:e[e.length-1]}}if("ArrowRight"===t.key||!t.shiftKey&&"Tab"===t.key){let e=d&&"Tab"===t.key?c:n,l=h(e,s,"r");if("ArrowRight"===t.key&&t.ctrlKey?r(s,l,!1):i=l[0],!i&&"Tab"===t.key){let t=e.filter((e=>e.getBoundingClientRect().y>s.getBoundingClientRect().y));i=t[0]?t[0]:e[0]}}i&&(t.preventDefault(),a(i),window.setTimeout((()=>{f(t,i)}),20),g?(s.classList.remove("tnys-sel-to"),i.classList.add("tnys-sel-to"),o&&B(o,i)):i.focus()),c.length<=1&&[9,13].includes(t.keyCode)&&(n.forEach((e=>{e.classList.remove("tnys-sel"),e.classList.remove("tnys-sel-from"),e.classList.remove("tnys-sel-to")})),i.classList.add("tnys-sel-from"))}}else{if(l>0){let e=g();s[l-1].forEach((t=>{let n=!1;for(let i=l-2;i>=0;i--)if(s[i].map((e=>e.path)).includes(t.path)){n=!0,y(s[i].filter((e=>e.path===t.path)),e);break}if(!n){let n=t.path.split("/")[1].split("_").map((e=>parseInt(e)));e[n[0]][n[1]].value=""}})),l--}t.preventDefault()}else{t.preventDefault();let e=s[l];e&&(y(e,g()),l++)}}function v(e){if("number"==typeof e.selectionStart)e.selectionStart=e.selectionEnd=e.value.length;else if(void 0!==e.createTextRange){e.focus();var t=e.createTextRange();t.collapse(!1),t.select()}}function C(e){e.classList.add("tnys-editing")}function B(e,t){let s=Math.min(e.getBoundingClientRect().x,t.getBoundingClientRect().x),l=Math.max(e.getBoundingClientRect().x,t.getBoundingClientRect().x),i=Math.min(e.getBoundingClientRect().y,t.getBoundingClientRect().y),r=Math.max(e.getBoundingClientRect().y,t.getBoundingClientRect().y);n.forEach((e=>{e.getBoundingClientRect().x>=s&&e.getBoundingClientRect().x<=l&&e.getBoundingClientRect().y>=i&&e.getBoundingClientRect().y<=r?e.classList.add("tnys-sel"):e.classList.remove("tnys-sel")}))}function L(e){let t=n.filter((t=>t.getBoundingClientRect().y===e.getBoundingClientRect().y)).map((e=>e.getBoundingClientRect().x));return{rowIndex:n.filter((t=>t.getBoundingClientRect().x===e.getBoundingClientRect().x)).map((e=>e.getBoundingClientRect().y)).indexOf(e.getBoundingClientRect().y),colIndex:t.indexOf(e.getBoundingClientRect().x)}}function E(e){let t=Object({targetId:e.target.id,ctrlKey:e.ctrlKey,key:e.key,type:e.type,keyCode:e.keyCode,shiftKey:e.shiftKey,which:e.which,timeStamp:e.timeStamp});return JSON.parse(JSON.stringify(t))}function R(e){return e.constructor===Event||e.constructor===KeyboardEvent||e.constructor===MouseEvent||e.constructor===FocusEvent?e:Object.assign({},e,{preventDefault:()=>{},target:document.getElementById(e.targetId)})}function b(e,t){return e.reduce(((e,n,s)=>(s%t||e.push([]),e[e.length-1].push(n),e)),[])}function k(e){return e.split('"').length-1}this.setMap=()=>{let e=g();u.pointers={};for(let t=0;t<e.length;t++)for(let n=0;n<e[t].length;n++){let s=`${t}_${n}`;e[t][n].setAttribute("tnys-id",s),u.pointers[s]={t:e[t-1]?e[t-1][n]:void 0,b:e[t+1]?e[t+1][n]:void 0,l:e[t]?e[t][n-1]:void 0,r:e[t]?e[t][n+1]:void 0}}},this.update=()=>{!function(e,t){for(let t=e.length-1;t>=0;t-=1)e[t].isConnected||e.splice(t,1)}(this.elements),Array.from(e.querySelectorAll("input:not(.tnys)")).forEach((l=>{l.classList.add("tnys"),function(l){l.addEventListener("change",(e=>{t&&t.recordCb&&t.recordCb({evt:E(e)});let n=L((e=R(e)).target),l=`${n.rowIndex}_${n.colIndex}`;c(),s.push([{op:"add",path:`/${l}`,value:e.target.value}])})),l.addEventListener("keydown",p),l.addEventListener("focus",(e=>{t&&t.recordCb&&t.recordCb({evt:E(e)}),(e=R(e)).target.selectionStart=e.target.selectionEnd=e.target.value.length,n.forEach((e=>{e.classList.remove("tnys-focus")})),e.target.classList.add("tnys-focus")})),l.addEventListener("blur",(e=>{t&&t.recordCb&&t.recordCb({evt:E(e)}),e=R(e),l.classList.remove("tnys-editing"),l.classList.remove("tnys-editing-hard")}));let i=!1;e.addEventListener("mouseup",(e=>{i=!1})),e.addEventListener("mousedown",(e=>{i=!0})),l.addEventListener("mouseenter",(s=>{if(t&&t.recordCb&&t.recordCb({evt:E(s)}),s=R(s),i){n.forEach((e=>{e.classList.remove("tnys-sel-to"),e.classList.remove("tnys-sel")}));let t=Array.from(e.getElementsByClassName("tnys-sel-from"))[0];s.target.classList.add("tnys-sel-to"),t&&B(t,s.target)}})),l.addEventListener("mousedown",(s=>{t&&t.recordCb&&t.recordCb({evt:E(s)}),a((s=R(s)).target),n.forEach((e=>{e.classList.remove("tnys-sel-to"),e.classList.remove("tnys-sel")}));let i=Array.from(e.getElementsByClassName("tnys-sel-from"));if(s.shiftKey){if(i.length){s.preventDefault();let e=i[0];s.target.classList.add("tnys-sel-to"),m(),B(e,s.target)}return}i.forEach((e=>{e.classList.remove("tnys-sel-from")}));let r=s.target.getAttribute("tnys-last-mousedown");r&&s.timeStamp-parseFloat(r)<=500&&!s.target.classList.contains("tnys-editing")&&(l.setAttribute("tnys-prev-value",l.value),s.preventDefault(),s.target.classList.add("tnys-editing-hard"),C(s.target)),s.target.setAttribute("tnys-last-mousedown",s.timeStamp),s.target.classList.add("tnys-sel-from"),s.target.focus(),void 0===s.mozInputSource||s.target.classList.contains("tnys-editing")||s.preventDefault()}))}(l),this.elements.includes(l)||this.elements.push(l)})),this.elements.sort(((e,t)=>e.getBoundingClientRect().y-t.getBoundingClientRect().y)),this.setMap()},this.update()}}})[138]();